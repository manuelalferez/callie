<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Callie</title>
    <link
      rel="icon"
      type="image/png"
      href="https://api.dicebear.com/9.x/adventurer-neutral/png?seed=Callie"
    />
    <link
      rel="apple-touch-icon"
      href="https://api.dicebear.com/9.x/adventurer-neutral/png?seed=Callie&size=180"
    />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <meta name="apple-mobile-web-app-title" content="Callie" />
    <link
      href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"
      rel="stylesheet"
    />
  </head>
  <body class="bg-gray-100 min-h-screen p-4 md:p-8">
    <div id="app" class="max-w-6xl mx-auto">
      <div class="bg-white rounded-xl shadow-xl p-4 md:p-8">
        <div class="flex flex-col items-center mb-8">
          <img
            src="https://api.dicebear.com/9.x/adventurer-neutral/png?seed=Callie"
            alt="Callie Logo"
            class="w-20 h-20 md:w-24 md:h-24 mb-4"
          />
          <h1
            class="text-3xl md:text-4xl font-bold text-center text-indigo-700"
          >
            Callie
          </h1>
        </div>

        <!-- Add Friend Form -->
        <div class="mb-8 md:mb-10 bg-indigo-50 p-4 md:p-6 rounded-lg">
          <h2
            class="text-xl md:text-2xl font-semibold mb-4 md:mb-6 text-indigo-600"
          >
            Add New Friend
          </h2>

          <div class="flex flex-col md:flex-row gap-4 md:gap-6 mb-4 md:mb-6">
            <div class="flex-1">
              <label
                class="block text-base md:text-lg font-medium text-gray-700 mb-2"
                >Friend's Name</label
              >
              <input
                type="text"
                id="friendName"
                placeholder="Enter friend's name"
                class="mt-1 block w-full rounded-lg border-2 border-indigo-200 p-2 md:p-3 text-base md:text-lg shadow-sm focus:border-indigo-500 focus:ring-indigo-500"
              />
            </div>

            <div class="flex-1">
              <label
                class="block text-base md:text-lg font-medium text-gray-700 mb-2"
                >Type of Friend</label
              >
              <div class="mt-1 flex flex-row gap-2 md:space-x-4">
                <button
                  onclick="setCloseness(true)"
                  id="closeBtn"
                  class="px-4 md:px-6 py-2 md:py-3 rounded-lg text-base md:text-lg font-medium transition-all duration-200 hover:transform hover:scale-105 bg-indigo-600 text-white w-full md:w-auto"
                >
                  Close Friend
                </button>
                <button
                  onclick="setCloseness(false)"
                  id="regularBtn"
                  class="px-4 md:px-6 py-2 md:py-3 rounded-lg text-base md:text-lg font-medium transition-all duration-200 hover:transform hover:scale-105 bg-white text-indigo-600 border-2 border-indigo-600 w-full md:w-auto"
                >
                  Regular Friend
                </button>
              </div>
            </div>
          </div>

          <button
            onclick="addFriend()"
            class="bg-indigo-600 text-white px-8 md:px-12 py-3 md:py-4 rounded-lg text-lg md:text-xl font-bold hover:bg-indigo-700 transition-colors duration-200 w-full shadow-lg hover:shadow-xl"
          >
            Add Friend to List
          </button>
        </div>

        <!-- Calendar View -->
        <div class="mb-8 md:mb-10">
          <h2
            class="text-xl md:text-2xl font-semibold mb-4 md:mb-6 text-indigo-700"
          >
            Upcoming Calls Calendar
          </h2>
          <div
            class="text-lg md:text-xl font-semibold text-center mb-4"
            id="currentMonth"
          ></div>
          <!-- Desktop Calendar -->
          <div class="hidden md:block">
            <div
              class="grid grid-cols-7 gap-2 mb-4 text-center text-base"
              id="calendarHeader"
            ></div>
            <div class="grid grid-cols-7 gap-2" id="calendarGrid"></div>
          </div>
          <!-- Mobile Calendar List -->
          <div class="md:hidden space-y-4" id="calendarList"></div>
        </div>

        <!-- Friends List -->
        <div class="bg-indigo-50 p-4 md:p-6 rounded-lg">
          <h2
            class="text-xl md:text-2xl font-semibold mb-4 md:mb-6 text-indigo-700"
          >
            Friends List
          </h2>
          <div class="space-y-4" id="friendsList"></div>
        </div>
      </div>
    </div>

    <script>
      let friends = [];
      let isClose = true;
      let timer = null;

      function setCloseness(close) {
        isClose = close;
        document.getElementById("closeBtn").className = close
          ? "px-4 md:px-6 py-2 md:py-3 rounded-lg text-base md:text-lg font-medium transition-all duration-200 hover:transform hover:scale-105 bg-indigo-600 text-white w-full md:w-auto"
          : "px-4 md:px-6 py-2 md:py-3 rounded-lg text-base md:text-lg font-medium transition-all duration-200 hover:transform hover:scale-105 bg-white text-indigo-600 border-2 border-indigo-600 w-full md:w-auto";
        document.getElementById("regularBtn").className = !close
          ? "px-4 md:px-6 py-2 md:py-3 rounded-lg text-base md:text-lg font-medium transition-all duration-200 hover:transform hover:scale-105 bg-indigo-600 text-white w-full md:w-auto"
          : "px-4 md:px-6 py-2 md:py-3 rounded-lg text-base md:text-lg font-medium transition-all duration-200 hover:transform hover:scale-105 bg-white text-indigo-600 border-2 border-indigo-600 w-full md:w-auto";
      }

      function addFriend() {
        const nameInput = document.getElementById("friendName");
        if (!nameInput.value) return;

        const today = new Date();
        const daysToAdd = isClose
          ? Math.floor(Math.random() * 3) + 1 // 1-3 days
          : Math.floor(Math.random() * 5) + 3; // 3-7 days

        const nextCall = new Date(today);
        nextCall.setDate(nextCall.getDate() + daysToAdd);

        friends.push({
          id: Date.now(),
          name: nameInput.value,
          isClose: isClose,
          nextCallDate: nextCall.toISOString(),
          avatar: `https://api.dicebear.com/9.x/adventurer-neutral/svg?seed=${nameInput.value}`,
        });

        // Reset form
        nameInput.value = "";
        setCloseness(true);

        // Save and refresh
        saveFriends();
        renderCalendar();
        renderFriendsList();
      }

      function markAsCalled(friendId) {
        const friend = friends.find((f) => f.id === friendId);
        if (!friend) return;

        const daysToAdd = friend.isClose
          ? Math.floor(Math.random() * 3) + 1
          : Math.floor(Math.random() * 5) + 3;

        const nextCall = new Date();
        nextCall.setDate(nextCall.getDate() + daysToAdd);
        friend.nextCallDate = nextCall.toISOString();

        saveFriends();
        renderCalendar();
        renderFriendsList();
      }

      function removeFriend(id) {
        friends = friends.filter((friend) => friend.id !== id);
        saveFriends();
        renderCalendar();
        renderFriendsList();
      }

      function saveFriends() {
        localStorage.setItem("friends", JSON.stringify(friends));
      }

      function loadFriends() {
        const saved = localStorage.getItem("friends");
        if (saved) {
          friends = JSON.parse(saved);
        }
      }

      function isToday(date) {
        const today = new Date();
        return (
          date.getDate() === today.getDate() &&
          date.getMonth() === today.getMonth() &&
          date.getFullYear() === today.getFullYear()
        );
      }

      function getFriendsForDate(date) {
        return friends.filter((friend) => {
          const callDate = new Date(friend.nextCallDate);
          return (
            callDate.getDate() === date.getDate() &&
            callDate.getMonth() === date.getMonth() &&
            callDate.getFullYear() === date.getFullYear()
          );
        });
      }

      function handleDragStart(e, friendId, originalDate) {
        e.dataTransfer.setData("friendId", friendId);
        e.dataTransfer.setData("originalDate", originalDate);
      }

      function handleDrop(e, newDate) {
        e.preventDefault();
        const friendId = parseInt(e.dataTransfer.getData("friendId"));
        const friend = friends.find((f) => f.id === friendId);
        if (friend) {
          friend.nextCallDate = newDate;
          saveFriends();
          renderCalendar();
          renderFriendsList();
        }
      }

      function handleDragOver(e) {
        e.preventDefault();
      }

      function renderCalendar() {
        const headerDiv = document.getElementById("calendarHeader");
        const gridDiv = document.getElementById("calendarGrid");
        const listDiv = document.getElementById("calendarList");
        const monthDiv = document.getElementById("currentMonth");
        const days = ["Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun"];
        const months = [
          "January",
          "February",
          "March",
          "April",
          "May",
          "June",
          "July",
          "August",
          "September",
          "October",
          "November",
          "December",
        ];

        const today = new Date();
        monthDiv.textContent =
          months[today.getMonth()] + " " + today.getFullYear();

        // Generate calendar days
        const calendarDays = [];
        const start = new Date(today);
        const dayOfWeek = today.getDay();
        const diff = dayOfWeek === 0 ? -6 : 1 - dayOfWeek;
        start.setDate(today.getDate() + diff);

        for (let i = 0; i < 28; i++) {
          const date = new Date(start);
          date.setDate(start.getDate() + i);
          calendarDays.push(date);
        }

        // Render desktop calendar
        headerDiv.innerHTML = days
          .map((day) => `<div class="font-bold text-gray-600">${day}</div>`)
          .join("");

        gridDiv.innerHTML = calendarDays
          .map((date) => {
            const dateString = date.toISOString();
            const friendsForDate = getFriendsForDate(date);

            return `
            <div 
              class="min-h-[120px] p-2 border rounded-lg ${
                isToday(date)
                  ? "bg-indigo-50 border-indigo-300"
                  : "border-gray-200"
              }"
              ondrop="handleDrop(event, '${dateString}')"
              ondragover="handleDragOver(event)"
            >
              <div class="text-sm text-gray-600 mb-2">${date.getDate()}</div>
              ${friendsForDate
                .map(
                  (friend) => `
                <div 
                  class="mb-2 p-2 rounded-lg text-sm bg-white shadow cursor-move"
                  draggable="true"
                  ondragstart="handleDragStart(event, ${friend.id}, '${
                    friend.nextCallDate
                  }')"
                >
                  <div class="flex items-center gap-2">
                    <img src="${friend.avatar}" class="w-6 h-6 rounded-full" />
                    <div class="font-medium truncate">${friend.name}</div>
                  </div>
                  <div class="text-xs text-gray-600">
                    ${friend.isClose ? "Close Friend" : "Regular Friend"}
                  </div>
                  ${
                    isToday(date)
                      ? `<button onclick="markAsCalled(${friend.id})" 
                         class="text-green-600 hover:text-green-800 text-xs mt-2 bg-green-50 px-2 py-1 rounded w-full">
                         Mark as Called
                       </button>`
                      : `<button onclick="removeFriend(${friend.id})" 
                         class="text-red-600 hover:text-red-800 text-xs mt-2 w-full">
                         Remove
                       </button>`
                  }
                </div>
              `
                )
                .join("")}
            </div>
          `;
          })
          .join("");

        // Render mobile calendar list
        listDiv.innerHTML = calendarDays
          .filter((date) => getFriendsForDate(date).length > 0)
          .map((date) => {
            const friendsForDate = getFriendsForDate(date);
            const isDateToday = isToday(date);
            const dateString = date.toLocaleDateString("en-US", {
              weekday: "short",
              month: "short",
              day: "numeric",
            });

            return `
              <div class="bg-white rounded-lg shadow p-4 ${
                isDateToday ? "border-2 border-indigo-400" : ""
              }">
                <div class="font-semibold text-lg mb-3 ${
                  isDateToday ? "text-indigo-600" : "text-gray-700"
                }">
                  ${dateString}
                  ${isDateToday ? " (Today)" : ""}
                </div>
                <div class="space-y-3">
                  ${friendsForDate
                    .map(
                      (friend) => `
                    <div class="flex items-center justify-between gap-3 p-2 bg-gray-50 rounded-lg">
                      <div class="flex items-center gap-2">
                        <img src="${
                          friend.avatar
                        }" class="w-8 h-8 rounded-full" />
                        <div>
                          <div class="font-medium">${friend.name}</div>
                          <div class="text-xs text-gray-600">
                            ${
                              friend.isClose ? "Close Friend" : "Regular Friend"
                            }
                          </div>
                        </div>
                      </div>
                      ${
                        isDateToday
                          ? `<button onclick="markAsCalled(${friend.id})" 
                             class="bg-green-100 text-green-700 px-3 py-1.5 rounded-lg text-sm">
                             Called
                           </button>`
                          : ""
                      }
                    </div>
                  `
                    )
                    .join("")}
                </div>
              </div>
            `;
          })
          .join("");
      }

      function renderFriendsList() {
        const listDiv = document.getElementById("friendsList");
        listDiv.innerHTML = friends
          .map(
            (friend) => `
          <div class="bg-white p-4 md:p-6 rounded-xl shadow-md hover:shadow-lg transition-shadow">
            <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
              <div class="flex items-center gap-4">
                <div class="w-10 h-10 md:w-12 md:h-12 rounded-full bg-indigo-100 flex items-center justify-center overflow-hidden">
                  <img src="${
                    friend.avatar
                  }" class="w-full h-full object-cover" />
                </div>
                <div>
                  <h3 class="font-bold text-lg md:text-xl text-gray-800">${
                    friend.name
                  }</h3>
                  <span class="inline-block px-3 py-1 rounded-full text-xs md:text-sm ${
                    friend.isClose
                      ? "bg-green-100 text-green-700"
                      : "bg-blue-100 text-blue-700"
                  }">
                    ${
                      friend.isClose
                        ? "Close Friend (1-3 days)"
                        : "Regular Friend (3-7 days)"
                    }
                  </span>
                </div>
              </div>
              <div class="flex flex-col md:flex-row gap-2 md:gap-3">
                <button
                  onclick="toggleFriendCloseness(${friend.id})"
                  class="flex items-center justify-center gap-2 px-3 md:px-4 py-2 rounded-lg text-sm ${
                    friend.isClose
                      ? "bg-blue-100 text-blue-700 hover:bg-blue-200"
                      : "bg-green-100 text-green-700 hover:bg-green-200"
                  }"
                >
                  <span>Switch to ${
                    friend.isClose ? "Regular" : "Close"
                  } Friend</span>
                </button>
                <button
                  onclick="removeFriend(${friend.id})"
                  class="bg-red-50 text-red-600 px-3 md:px-4 py-2 rounded-lg hover:bg-red-100 transition-colors text-sm"
                >
                  Delete
                </button>
              </div>
            </div>
          </div>
        `
          )
          .join("");
      }

      function toggleFriendCloseness(friendId) {
        const friend = friends.find((f) => f.id === friendId);
        if (!friend) return;

        friend.isClose = !friend.isClose;
        const daysToAdd = friend.isClose
          ? Math.floor(Math.random() * 3) + 1
          : Math.floor(Math.random() * 5) + 3;

        const nextCall = new Date();
        nextCall.setDate(nextCall.getDate() + daysToAdd);
        friend.nextCallDate = nextCall.toISOString();

        saveFriends();
        renderCalendar();
        renderFriendsList();
      }

      // Initialize
      window.onload = function () {
        loadFriends();
        renderCalendar();
        renderFriendsList();
        // Update every minute
        timer = setInterval(() => {
          renderCalendar();
          renderFriendsList();
        }, 60000);
      };

      // Cleanup
      window.onunload = function () {
        if (timer) {
          clearInterval(timer);
        }
      };
    </script>
  </body>
</html>
