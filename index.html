<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Friend Call Reminder</title>
    <link
      href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"
      rel="stylesheet"
    />
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  </head>
  <body class="bg-gray-100 min-h-screen p-8">
    <div id="app" class="max-w-6xl mx-auto">
      <div class="bg-white rounded-xl shadow-xl p-8">
        <h1 class="text-4xl font-bold mb-8 text-center text-indigo-700">
          Friend Call Reminder
        </h1>

        <!-- Add Friend Form -->
        <div class="mb-10 bg-indigo-50 p-6 rounded-lg">
          <h2 class="text-2xl font-semibold mb-6 text-indigo-600">
            Add New Friend
          </h2>

          <div class="mb-6">
            <label class="block text-lg font-medium text-gray-700 mb-2"
              >Friend's Name</label
            >
            <input
              type="text"
              v-model="newFriend.name"
              placeholder="Enter friend's name"
              class="mt-1 block w-full rounded-lg border-2 border-indigo-200 p-3 text-lg shadow-sm focus:border-indigo-500 focus:ring-indigo-500"
            />
          </div>

          <div class="mb-6">
            <label class="block text-lg font-medium text-gray-700 mb-2"
              >How often would you like to call them?</label
            >
            <div class="mt-3 space-x-6">
              <button
                @click="setCloseness(true)"
                :class="{'bg-indigo-600 text-white': newFriend.isClose, 'bg-white text-indigo-600 border-2 border-indigo-600': !newFriend.isClose}"
                class="px-6 py-3 rounded-lg text-lg font-medium transition-all duration-200 hover:transform hover:scale-105"
              >
                Close Friend (1-3 days)
              </button>
              <button
                @click="setCloseness(false)"
                :class="{'bg-indigo-600 text-white': !newFriend.isClose, 'bg-white text-indigo-600 border-2 border-indigo-600': newFriend.isClose}"
                class="px-6 py-3 rounded-lg text-lg font-medium transition-all duration-200 hover:transform hover:scale-105"
              >
                Regular Friend (3-7 days)
              </button>
            </div>
          </div>

          <button
            @click="addFriend"
            class="bg-indigo-600 text-white px-8 py-3 rounded-lg text-lg font-medium hover:bg-indigo-700 transition-colors duration-200 w-full md:w-auto"
          >
            Add Friend to List
          </button>
        </div>

        <!-- Calendar View -->
        <div>
          <h2 class="text-2xl font-semibold mb-6 text-indigo-700">
            Upcoming Calls Calendar
          </h2>
          <div class="grid grid-cols-7 gap-2 mb-4 text-center">
            <div
              v-for="day in ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun']"
              class="font-bold text-gray-600"
            >
              {{ day }}
            </div>
          </div>
          <div class="grid grid-cols-7 gap-2">
            <template v-for="date in calendarDays" :key="date.toISOString()">
              <div
                class="min-h-[120px] p-2 border rounded-lg"
                :class="isToday(date) ? 'bg-indigo-50 border-indigo-300' : 'border-gray-200'"
              >
                <div class="text-sm text-gray-600 mb-2">
                  {{ formatCalendarDate(date) }}
                </div>
                <div
                  v-for="friend in getFriendsForDate(date)"
                  :key="friend.id"
                  class="mb-2 p-2 rounded-lg text-sm bg-white shadow"
                >
                  <div class="font-medium">{{ friend.name }}</div>
                  <div class="text-xs text-gray-600">
                    {{ friend.isClose ? 'Close Friend' : 'Regular Friend' }}
                  </div>
                  <button
                    v-if="isToday(date)"
                    @click="markAsCalled(friend)"
                    class="text-green-600 hover:text-green-800 text-xs mt-2 bg-green-50 px-2 py-1 rounded"
                  >
                    Mark as Called
                  </button>
                  <button
                    v-else
                    @click="removeFriend(friend.id)"
                    class="text-red-600 hover:text-red-800 text-xs mt-2"
                  >
                    Remove
                  </button>
                </div>
              </div>
            </template>
          </div>
        </div>
      </div>
    </div>

    <script>
      const { createApp } = Vue;

      createApp({
        data() {
          return {
            newFriend: {
              name: "",
              isClose: true,
            },
            friends: [],
            timer: null,
          };
        },
        computed: {
          calendarDays() {
            const today = new Date();
            const days = [];
            // Start from the beginning of current week (Monday)
            const start = new Date(today);
            const dayOfWeek = today.getDay();
            const diff = dayOfWeek === 0 ? -6 : 1 - dayOfWeek; // Adjust to get Monday
            start.setDate(today.getDate() + diff);

            // Generate 28 days (4 weeks)
            for (let i = 0; i < 28; i++) {
              const date = new Date(start);
              date.setDate(start.getDate() + i);
              days.push(date);
            }
            return days;
          },
        },
        methods: {
          setCloseness(isClose) {
            this.newFriend.isClose = isClose;
          },
          addFriend() {
            if (!this.newFriend.name) return;

            const today = new Date();
            const daysToAdd = this.newFriend.isClose
              ? Math.floor(Math.random() * 3) + 1 // 1-3 days
              : Math.floor(Math.random() * 5) + 3; // 3-7 days

            const nextCall = new Date(today);
            nextCall.setDate(nextCall.getDate() + daysToAdd);

            this.friends.push({
              id: Date.now(),
              name: this.newFriend.name,
              isClose: this.newFriend.isClose,
              nextCallDate: nextCall.toISOString(),
            });

            // Reset form
            this.newFriend.name = "";
            this.newFriend.isClose = true;

            // Save to localStorage
            this.saveFriends();
          },
          markAsCalled(friend) {
            // Calculate next call date based on friend type
            const daysToAdd = friend.isClose
              ? Math.floor(Math.random() * 3) + 1 // 1-3 days
              : Math.floor(Math.random() * 5) + 3; // 3-7 days

            const nextCall = new Date();
            nextCall.setDate(nextCall.getDate() + daysToAdd);

            // Update friend's next call date
            const index = this.friends.findIndex((f) => f.id === friend.id);
            if (index !== -1) {
              this.friends[index].nextCallDate = nextCall.toISOString();
              this.saveFriends();
            }
          },
          removeFriend(id) {
            this.friends = this.friends.filter((friend) => friend.id !== id);
            this.saveFriends();
          },
          saveFriends() {
            localStorage.setItem("friends", JSON.stringify(this.friends));
          },
          loadFriends() {
            const saved = localStorage.getItem("friends");
            if (saved) {
              this.friends = JSON.parse(saved);
            }
          },
          formatDate(dateString) {
            return new Date(dateString).toLocaleDateString("en-US", {
              weekday: "long",
              year: "numeric",
              month: "long",
              day: "numeric",
            });
          },
          formatCalendarDate(date) {
            return date.getDate();
          },
          isToday(date) {
            const today = new Date();
            return (
              date.getDate() === today.getDate() &&
              date.getMonth() === today.getMonth() &&
              date.getFullYear() === today.getFullYear()
            );
          },
          getFriendsForDate(date) {
            return this.friends.filter((friend) => {
              const callDate = new Date(friend.nextCallDate);
              return (
                callDate.getDate() === date.getDate() &&
                callDate.getMonth() === date.getMonth() &&
                callDate.getFullYear() === date.getFullYear()
              );
            });
          },
          getTimeLeft(dateString) {
            const now = new Date();
            const callDate = new Date(dateString);
            const diff = callDate - now;

            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor(
              (diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)
            );
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));

            if (diff < 0) {
              return "Call overdue!";
            }

            return `Time left: ${days}d ${hours}h ${minutes}m`;
          },
          getTimeLeftColor(dateString) {
            const now = new Date();
            const callDate = new Date(dateString);
            const diff = callDate - now;

            if (diff < 0) {
              return "text-red-600 font-bold bg-red-50";
            } else if (diff < 24 * 60 * 60 * 1000) {
              // less than 24 hours
              return "text-yellow-600 bg-yellow-50";
            }
            return "text-green-600 bg-green-50";
          },
          updateCountdowns() {
            // Force a re-render of the countdown timers
            this.friends = [...this.friends];
          },
        },
        mounted() {
          this.loadFriends();
          // Update countdowns every minute
          this.timer = setInterval(this.updateCountdowns, 60000);
        },
        beforeUnmount() {
          if (this.timer) {
            clearInterval(this.timer);
          }
        },
      }).mount("#app");
    </script>
  </body>
</html>
